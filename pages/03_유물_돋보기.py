
import streamlit as st
import google.generativeai as genai
from PIL import Image

# --- í˜ì´ì§€ ì„¤ì • ---
st.set_page_config(
    page_title="ğŸ¨ ì´ë¯¸ì§€ ê¸°ë°˜ ìœ ë¬¼ ë¶„ì„ê¸°",
    page_icon="ğŸ“œ",
    layout="wide"
)

# --- âœ… ìë™ ìƒì„±ëœ ìƒë‹¨ ë©”ë‰´ë¥¼ ìˆ¨ê¸°ëŠ” CSS ì½”ë“œ ---
st.markdown("""
<style>
    [data-testid="stSidebarNav"] {
        display: none;
    }
</style>
""", unsafe_allow_html=True)


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ì‚¬ì´ë“œë°”: ë‚´ë¹„ê²Œì´ì…˜ & API í‚¤ ì„¤ì •
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.sidebar.title("ğŸ“š ë©”ë‰´")
st.sidebar.page_link("01_ë°•ë¬¼ê´€_ìœ„ì¹˜_ê²€ìƒ‰.py", label="1. ë°•ë¬¼ê´€ ìœ„ì¹˜ ê²€ìƒ‰", icon="ğŸ›ï¸")
st.sidebar.page_link("pages/02_íë ˆì´í„°_ì±—ë´‡.py", label="2. íë ˆì´í„° ì±—ë´‡", icon="ğŸ—£ï¸")
st.sidebar.page_link("pages/03_ìœ ë¬¼_ë‹ë³´ê¸°.py", label="3. ìœ ë¬¼ ë‹ë³´ê¸°", icon="ğŸ–¼ï¸")
st.sidebar.page_link("pages/04_QnA_for_foreigners.py", label="4. Q&A for Foreigners", icon="â“")
st.sidebar.markdown("---")
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# API í‚¤ ì„¤ì • (st.secrets ì‚¬ìš©)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
try:
    google_api_key = st.secrets["GOOGLE_API_KEY"]
    st.sidebar.success("âœ… Google API í‚¤ ë¡œë“œ ì„±ê³µ!")
except (KeyError, FileNotFoundError):
    google_api_key = ""
    st.sidebar.error("âš ï¸ `secrets.toml`ì— Google API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.")

# --- ë©”ì¸ í™”ë©´ êµ¬ì„± ---
st.title("ğŸ–¼ï¸ ì´ë¯¸ì§€ ê¸°ë°˜ ìœ ë¬¼ ë‹ë³´ê¸°")
st.markdown("ìœ ë¬¼, ì˜ˆìˆ  ì‘í’ˆ, ì—­ì‚¬ì  ì‚¬ì§„ ë“±ì„ ì—…ë¡œë“œí•˜ë©´ AIê°€ íë ˆì´í„°ì²˜ëŸ¼ ì„¤ëª…í•´ ë“œë¦½ë‹ˆë‹¤.")
st.markdown("---")

# ì´ë¯¸ì§€ ì—…ë¡œë”
uploaded_file = st.file_uploader(
    "ë¶„ì„í•  ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.",
    type=["jpg", "jpeg", "png"]
)

if uploaded_file is not None:
    image = Image.open(uploaded_file)
    st.image(image, caption=f"ë¶„ì„ ëŒ€ìƒ ì´ë¯¸ì§€: {uploaded_file.name}", use_column_width=True)

    if st.button("ğŸš€ ì´ë¯¸ì§€ ë¶„ì„ ì‹œì‘", type="primary"):
        if not google_api_key:
            st.error("âš ï¸ ì‚¬ì´ë“œë°”ì—ì„œ Google API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.")
            st.stop()

        try:
            genai.configure(api_key=google_api_key)
            model = genai.GenerativeModel(model_name='gemini-1.5-flash')

            prompt = """
            ë‹¹ì‹ ì€ í•´ë°•í•œ ì§€ì‹ì„ ê°€ì§„ ë°•ë¬¼ê´€ì˜ ì „ë¬¸ íë ˆì´í„°ì…ë‹ˆë‹¤.
            ì£¼ì–´ì§„ ì´ë¯¸ì§€ë¥¼ ë³´ê³ , ì•„ë˜ì˜ í˜•ì‹ì— ë§ì¶° ìœ ë¬¼ ë˜ëŠ” ì˜ˆìˆ  ì‘í’ˆì— ëŒ€í•´ ìƒì„¸í•˜ê³  ê¹Šì´ ìˆê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”.
            ì„¤ëª…ì€ ì´ˆë“±í•™ìƒë„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì‰½ê³  í¥ë¯¸ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”. ê´€ë ¨ ìœ ë¬¼ì´ ê²€ìƒ‰ë˜ì§€ ì•Šì„ ë•Œì—ëŠ” ìƒìƒì— ê¸°ë°˜í•´ì„œ ì§€ì–´ë‚´ì§€ ë§ê³  ì‚¬ì‹¤ì„ ê¸°ë°˜ìœ¼ë¡œ ì •í™•í•œ ì •ë³´ë§Œ ì œê³µí•˜ì„¸ìš”.

            **1. ëª…ì¹­:** (ì´ë¯¸ì§€ë¥¼ í†µí•´ ì¶”ì •ë˜ëŠ” ê³µì‹ ëª…ì¹­ ë˜ëŠ” ì¼ë°˜ ëª…ì¹­)

            **2. ì‹œëŒ€ì™€ ì¶œì²˜:** (ì–´ëŠ ì‹œëŒ€ì—, ì–´ë””ì—ì„œ ë§Œë“¤ì–´ì¡ŒëŠ”ì§€)

            **3. ì¬ë£Œ ë° ê¸°ë²•:** (ë¬´ì—‡ìœ¼ë¡œ, ì–´ë–»ê²Œ ë§Œë“¤ì–´ì¡ŒëŠ”ì§€)

            **4. íŠ¹ì§•ê³¼ ì˜ë¯¸:** (ìƒê¹€ìƒˆì˜ íŠ¹ì§•ê³¼ ê·¸ ì•ˆì— ë‹´ê¸´ ìƒì§•ì´ë‚˜ ì˜ë¯¸)

            **5. ì—­ì‚¬ì  ê°€ì¹˜:** (ì´ ìœ ë¬¼ì´ ì™œ ì¤‘ìš”í•˜ê³  ëŒ€ë‹¨í•œì§€)

            **6. ì¬ë¯¸ìˆëŠ” ì´ì•¼ê¸°:** (ì´ ìœ ë¬¼ê³¼ ê´€ë ¨ëœ í¥ë¯¸ë¡œìš´ ì¼í™”ë‚˜ ì‚¬ì‹¤)
            """

            with st.spinner("AI íë ˆì´í„°ê°€ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."):
                response = model.generate_content([prompt, image])

                st.subheader("ğŸ“Š AI íë ˆì´í„° ë¶„ì„ ê²°ê³¼")
                st.markdown(response.text)

                # ë¶„ì„ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼
                st.download_button(
                    label="ğŸ“¥ ë¶„ì„ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ",
                    data=response.text.encode('utf-8'),
                    file_name=f"ë¶„ì„ê²°ê³¼_{uploaded_file.name.split('.')[0]}.txt",
                    mime="text/plain"
                )

        except Exception as e:
            st.error(f"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
            st.info("API í‚¤ê°€ ì •í™•í•œì§€, í• ë‹¹ëŸ‰ì´ ì´ˆê³¼ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”. ë¬¸ì œê°€ ì§€ì†ë˜ë©´ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")

else:
    st.info("ğŸ–¼ï¸ ë¶„ì„í•˜ê³  ì‹¶ì€ ìœ ë¬¼ì´ë‚˜ ì˜ˆìˆ  ì‘í’ˆ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œ í•´ì£¼ì„¸ìš”.")
    st.markdown("""
    ### ğŸŒŸ ì´ëŸ° ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•  ìˆ˜ ìˆì–´ìš”!
    - **í•œêµ­ ìœ ë¬¼**: ê³ ë ¤ì²­ì, ë°±ì œ ê¸ˆë™ëŒ€í–¥ë¡œ, ì‹ ë¼ ê¸ˆê´€, ì¡°ì„ ë°±ì ë“±
    - **ì„¸ê³„ ìœ ë¬¼**: ì´ì§‘íŠ¸ ë¡œì œíƒ€ì„, ë©”ì†Œí¬íƒ€ë¯¸ì•„ í•¨ë¬´ë¼ë¹„ ë²•ì „ ë“±
    - **ë¯¸ìˆ  ì‘í’ˆ**: ë ˆì˜¤ë‚˜ë¥´ë„ ë‹¤ë¹ˆì¹˜ì˜ 'ëª¨ë‚˜ë¦¬ì', ê¹€í™ë„ì˜ 'ì”¨ë¦„' ë“±
    - **ì—­ì‚¬ì  ì‚¬ì§„**: í‘ë°±ìœ¼ë¡œ ëœ ì˜›ë‚  ì‚¬ì§„ì´ë‚˜ ì—­ì‚¬ì  ì‚¬ê±´ í˜„ì¥ ì‚¬ì§„
    """)
    #streamlit run app.py